<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="/assets/bootstrap/bootstrap.css" rel="stylesheet" />
                <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Roboto+Slab:wght@400;700&family=Roboto:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet" data-no-mirror>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.26.0/themes/prism.css">
        <link href="/assets/css/theme.css" rel="stylesheet" />
        <link href="/assets/css/styles.css" rel="stylesheet" />

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/a1cad7ed9a.js" crossorigin="anonymous" data-no-mirror></script>
        <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.26.0/components/prism-core.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.26.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
        <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
	    
        <!-- Lunr search -->

        

        

        <title>.NetBlocks - DotNetBlocks.Extensions</title>
    </head>
    <body class="d-flex flex-column">
        <div class="flex-grow-1 d-flex flex-column">
            <div class="bg-nav">
                <div class="container-xl py-3">
                    <div class="row">
                        <div class="offset-lg-2 col-12 col-lg-8 px-0">
                            <nav class="navbar navbar-expand-md navbar-light align-items-start">
    <a class="navbar-brand" href="/">
                <span class="text-primary">.NetBlocks</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapse-topnav" aria-controls="collapse-topnav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="collapse-topnav" class="collapse navbar-collapse flex-wrap">
        <ul class="navbar-nav mr-auto">
            
        </ul>
        <ul class="navbar-nav">
                    <li class="nav-item">
            <a class="nav-link" href="/get.started">Get started</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/Libraries">Libraries</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/Design">Design</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/api">API</a>
        </li>

            
        </ul>
    </div>
</nav>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex-grow-1 d-flex flex-column">
                    <!-- Titlebar -->
                    <div id="titlebar" class="py-4">
                        <div class="container-xl">
                            <div class="row">
                                <div class="offset-lg-2 col-12 col-lg-8 px-3 px-lg-0 w-100 d-flex flex-wrap align-items-end">
                                    <div class="flex-grow-1">
                                        <div class="breadcrumbs d-flex flex-column flex-md-row text-break">

        <span><a href="/Libraries">Libraries</a></span>
                                        </div>
                                        <div class="text-white m-0 text-break title">

DotNetBlocks.Extensions
                                        </div>
                                    </div>
                                        <div class="navbar navbar-expand-md navbar-dark p-0">
                                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#left-sidebar" aria-controls="left-sidebar" aria-expanded="false" aria-label="Toggle navigation">
                                                <span class="navbar-toggler-icon"></span>
                                            </button>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Under title -->
                    <div id="undertitle">
                        <div class="container-xl">
                            <div class="row">
                                    <div class="col-md-3 col-lg-2">
                                    </div>
                                    <div class="col-md-9 col-lg-8 bg-white">
                                    </div>
                                <div class="col-lg-2 d-none d-lg-block">
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- Body -->
                <div class="flex-grow-1 d-flex flex-column">
                        <div class="container-xl flex-grow-1 d-flex flex-column">
                            <div class="row flex-grow-1 align-items-stretch">
                                        <div class="col-md-3 col-lg-2 p-md-0 m-md-0 bg-body">
                                            <div id="left-sidebar" class="sidebar collapse px-0 px-md-3 pt-3">

<div class="sidebar-root">

<div class="sidebar-nav-item">
    <a href="/Libraries/business.shared">Business.Shared</a>
</div>
<div class="sidebar-nav-item active">
    <a href="/Libraries/extensions">DotNetBlocks.Extensions</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/servicebus">DotNetBlocks.ServiceBus</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/servicebus.shared">DotNetBlocks.ServiceBus.Shared</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/system.io">DotNetBlocks.System.IO</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/system.threading">dotNetBlocks.System.Threading</a>
</div></div>                                            </div>
                                        </div>
                                        <div id="content" class="col-md-9 col-lg-8 p-4 pt-md-0 bg-white">
<h1 id="dotnetblocks.extensions.dependencyinjection">DotNetBlocks.Extensions.DependencyInjection</h1>
<p>Adds functionality to the Microsoft.Extensions namespace to solve Lazy<T> DI and other missing functionality problems.</p>
<h3 id="getting-started">Getting started</h3>
<p><a href="https://www.nuget.org/packages/dotNetBlocks.Extensions.DependencyInjection"> NuGet : DotNetBlocks.Extensions.DependencyInjection</a></p>
<p><a href="/">Licensing and other information</a></p>
<h3 id="functionality">Functionality</h3>
<h2 id="dependencyinjection">DependencyInjection</h2>
<p>To improve performance, design patterns use the injection of Lazy<TService> in their constructors to delay the cost of initiation to JustInTime.
Microsoft DI does not support LAZY Service types. Options are to use a different DI provider or use these extensions.</p>
<h3 id="problems-solved">Problems Solved</h3>
<p>Lack of support for lazy types in Microsoft.Extensions.DependencyInjection</p>
<p>#Examples</p>
<h1 id="dependency-injection-problem-solved">Dependency Injection Problem Solved.</h1>
<p>Microsoft DI is the simplest DI system available and does not support inferring Lazy<T> using already registered service types.
The most effective solution to wasting resources when injecting Services via class constructor parameters is using a Lazy&lt;Service pattern.
This delays the construction of the resource until first use.</p>
<p>If you use MS DI, you have to registee the Lazy<T> for every class that may be lazy, and we want the DI container to generically support Lazy<T> for our constructors.</p>
<p>We need to add the functionality to create any Lazy<T> class if the service is already registered.</p>
<h1 id="alternatives">Alternatives</h1>
<p>A better solution is to use AutoFac or other open source DI systems and leverage the more advanced functionality.</p>
<h2 id="the-solution">The Solution</h2>
<h2 id="references">References</h2>
<p><a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection">Microsoft DI</a>
<a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection-guidelines#default-service-container-replacement">Default Service Container Replacement</a></p>
<h1 id="implementation-notes">Implementation notes</h1>
<p>A first attempt was to use a lighter facade factory pattern using implicit type conventions, but issues with Di type conversion testing on implicit classes prevented its use.
The final lazy implementation had to exactly match the lazy<T> signature, so extending the class with DI support became the easiest solution.
You also can't use a generic factory method and a dynamic keyword because there is no way to add a parameter that can be used for dynamic type discovery.</p>
<p>Solution inspiration is this discussion aboard
<a href="https://stackoverflow.com/questions/44934511/does-net-core-dependency-injection-support-lazyt">Solution ideas discussion - for credit</a></p>
<h2 id="details">details</h2>
<p>This library implements two solutions internally. One uses a Lazy Implementation class that inherits from Lazy but with a constructor with DI support. This is a simple but effective solution to the problem
and is the soution implementation when you &quot;add Lazy Support&quot; to the service collection. It registers this LazyService type for use in all lazy<T> requests.</p>
<p>The second implementation is a &quot;true lazy&quot; implementation using a delegate constructor to create an true Lazy class with a dynamic costructor. This is the solution used when you use a Lazy registration for a type or the AsLazy registration extension method.
The &quot;true&quot; implementation is modeled on the standard microsoft libraries, using copied and modified versions of the microsoft DI service registration and service descriptor static methods.</p>
<p>The internal pattern is to create ServiceDescriptors using the &quot;describe&quot; pattern and add those to the service collection. The describe method creates the appropriate factories and lifetimes supporting the requeted lazy usage registration type.</p>
<h2 id="factory-methods">Factory methods</h2>
<p>The factory methods use methodInfo to close the types and invoke the factory method builder, but its important to note this does not have a performance impact, because the builder method is only called during registration to create an appropriate delegate that is passed to the dependency registration. This technique is faster than building the lambdas using code and more maintainable.</p>


                                        </div>
                                <div class="col-lg-2 p-md-0 m-md-0 bg-body">
                                    <div id="right-sidebar" class="sidebar px-0 px-md-3 pt-3">
        <div class=" mb-3 sidebar-root">
            <div class="sidebar-nav-item sidebar-header">On This Page</div>
            <div class="sidebar-nav-children">
                    <div class="sidebar-nav-item"><a href="#dotnetblocks.extensions.dependencyinjection">DotNetBlocks.Extensions.DependencyInjection</a></div>
                        <div class="sidebar-nav-children">
                                <div class="sidebar-nav-item"><a href="#dependencyinjection">DependencyInjection</a></div>
                        </div>
                    <div class="sidebar-nav-item"><a href="#dependency-injection-problem-solved">Dependency Injection Problem Solved.</a></div>
                    <div class="sidebar-nav-item"><a href="#alternatives">Alternatives</a></div>
                        <div class="sidebar-nav-children">
                                <div class="sidebar-nav-item"><a href="#the-solution">The Solution</a></div>
                                <div class="sidebar-nav-item"><a href="#references">References</a></div>
                        </div>
                    <div class="sidebar-nav-item"><a href="#implementation-notes">Implementation notes</a></div>
                        <div class="sidebar-nav-children">
                                <div class="sidebar-nav-item"><a href="#details">details</a></div>
                                <div class="sidebar-nav-item"><a href="#factory-methods">Factory methods</a></div>
                        </div>
            </div>
        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div id="footer" class="p-3 text-white">
            <div class="container-xl">
                <div class="row">
    <div class="offset-lg-2 col-12 col-lg-8">
        <div class="pt-2 font-size-sm text-muted text-center">
            Generated By <a class="text-muted" href="https://statiq.dev">Statiq</a>
        </div>
    </div>
</div>
            </div>
        </div>

        <!-- Scripts -->
        <script>
            $(document).ready(function() {
                quicklink.listen();

                // Bootstrap tooltips
                $('[data-toggle="tooltip"]').tooltip();

				// Keeps the sidebars in view on wider viewports
				let left = null;
				let leftParent = null;
				let right = null;
				let rightParent = null;
                function stickSidebars()
				{
				    if (left == null) {
                        left = $('#left-sidebar');
                        right = $('#right-sidebar');
                    }
                    if (left.length) {
                        if (window.innerWidth >= 768) {
                            if (leftParent == null) {
                                leftParent = left.parent()[0];
                            }
                            if (leftParent) {
                                let leftRect = leftParent.getBoundingClientRect();
                                stickSidebar(left,  leftRect);
                            }
                        } else {
                            left.css('position', 'relative');
                            if (left.css('bottom') != 0) {
                                left.css('bottom', '0');
                            }
                        }
                    }
                    if (right.length) {
                        if (window.innerWidth >= 768) {
                            if (rightParent == null) {
                                rightParent = right.parent()[0];
                            }
                            if (rightParent) {
                                let rightRect = rightParent.getBoundingClientRect();
                                stickSidebar(right,  rightRect);
                            }
                        } else {
                            right.css('position', 'relative');
                            if (right.css('bottom') != 0) {
                                right.css('bottom', '0');
                            }
                        }
                    }
				}
				function stickSidebar(sidebar, rect) {
                    // Bottom
                    if (rect.bottom > window.innerHeight) {
                        sidebar.css('bottom', rect.bottom - window.innerHeight + "px");
                    } else {
                        sidebar.css('bottom', 0);
                    }
                    // Top
                    if (rect.top < 0) {
                        sidebar.css('position', 'sticky');
                    } else {
                        sidebar.css('position', 'absolute');
                    }
				}
				$(window).on("load", function() {
				    stickSidebars();
				});
                $(window).scroll(function() {
				    stickSidebars();
				});
				$(window).resize(function() {
				    stickSidebars();
				})

                // Mermaid diagrams
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-fluid');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();

                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
            });
        </script>

        

        
    </body>
</html>