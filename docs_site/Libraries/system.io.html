<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="/assets/bootstrap/bootstrap.css" rel="stylesheet" />
                <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Roboto+Slab:wght@400;700&family=Roboto:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet" data-no-mirror>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.26.0/themes/prism.css">
        <link href="/assets/css/theme.css" rel="stylesheet" />
        <link href="/assets/css/styles.css" rel="stylesheet" />

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/a1cad7ed9a.js" crossorigin="anonymous" data-no-mirror></script>
        <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.26.0/components/prism-core.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.26.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
        <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
	    
        <!-- Lunr search -->

        

        

        <title>.NetBlocks - DotNetBlocks.System.IO</title>
    </head>
    <body class="d-flex flex-column">
        <div class="flex-grow-1 d-flex flex-column">
            <div class="bg-nav">
                <div class="container-xl py-3">
                    <div class="row">
                        <div class="offset-lg-2 col-12 col-lg-8 px-0">
                            <nav class="navbar navbar-expand-md navbar-light align-items-start">
    <a class="navbar-brand" href="/">
                <span class="text-primary">.NetBlocks</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapse-topnav" aria-controls="collapse-topnav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="collapse-topnav" class="collapse navbar-collapse flex-wrap">
        <ul class="navbar-nav mr-auto">
            
        </ul>
        <ul class="navbar-nav">
                    <li class="nav-item">
            <a class="nav-link" href="/get.started">Get started</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/Libraries">Libraries</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/Design">Design</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/api">API</a>
        </li>

            
        </ul>
    </div>
</nav>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex-grow-1 d-flex flex-column">
                    <!-- Titlebar -->
                    <div id="titlebar" class="py-4">
                        <div class="container-xl">
                            <div class="row">
                                <div class="offset-lg-2 col-12 col-lg-8 px-3 px-lg-0 w-100 d-flex flex-wrap align-items-end">
                                    <div class="flex-grow-1">
                                        <div class="breadcrumbs d-flex flex-column flex-md-row text-break">

        <span><a href="/Libraries">Libraries</a></span>
                                        </div>
                                        <div class="text-white m-0 text-break title">

DotNetBlocks.System.IO
                                        </div>
                                    </div>
                                        <div class="navbar navbar-expand-md navbar-dark p-0">
                                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#left-sidebar" aria-controls="left-sidebar" aria-expanded="false" aria-label="Toggle navigation">
                                                <span class="navbar-toggler-icon"></span>
                                            </button>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Under title -->
                    <div id="undertitle">
                        <div class="container-xl">
                            <div class="row">
                                    <div class="col-md-3 col-lg-2">
                                    </div>
                                    <div class="col-md-9 col-lg-8 bg-white">
                                    </div>
                                <div class="col-lg-2 d-none d-lg-block">
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- Body -->
                <div class="flex-grow-1 d-flex flex-column">
                        <div class="container-xl flex-grow-1 d-flex flex-column">
                            <div class="row flex-grow-1 align-items-stretch">
                                        <div class="col-md-3 col-lg-2 p-md-0 m-md-0 bg-body">
                                            <div id="left-sidebar" class="sidebar collapse px-0 px-md-3 pt-3">

<div class="sidebar-root">

<div class="sidebar-nav-item">
    <a href="/Libraries/business.shared">Business.Shared</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/extensions">DotNetBlocks.Extensions</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/servicebus">DotNetBlocks.ServiceBus</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/servicebus.shared">DotNetBlocks.ServiceBus.Shared</a>
</div>
<div class="sidebar-nav-item active">
    <a href="/Libraries/system.io">DotNetBlocks.System.IO</a>
</div>
<div class="sidebar-nav-item">
    <a href="/Libraries/system.threading">dotNetBlocks.System.Threading</a>
</div></div>                                            </div>
                                        </div>
                                        <div id="content" class="col-md-9 col-lg-8 p-4 pt-md-0 bg-white">
<h1 id="dotnetblocks.system.io">DotNetBlocks.System.IO</h1>
<h3 id="overview">Overview</h3>
<p>Adds new buffering and copy functionality to streams in the system.io namespace.</p>
<h3 id="getting-started">Getting started</h3>
<p><a href="https://www.nuget.org/packages/dotNetBlocks.System.IO"> NuGet : dotnetBlocks.System.IO</a></p>
<p><a href="/">Licensing and other information</a></p>
<h3 id="functionality">Functionality</h3>
<p>New Stream functionality.</p>
<ul>
<li>Stream Buffer - advanced concurrent reading and writing pass through</li>
<li>Stream Copy Extensions - let you calculate the CRC or copy parts of a stream.</li>
</ul>
<h1 id="stream-buffer">Stream Buffer</h1>
<p>A stream buffer wraps a source stream, allowing the consumer code to read the stream without pulling the entire stream into memory. Supports background process threading.</p>
<h1 id="problem-solved">Problem solved</h1>
<p>In the code pattern where a source wants to write into a sink stream and another process wants to read the stream to write it into another destination, developers often use a MemoryStream class.
This causes temporary spikes in memory usage, especially if the streams are files of unknown size. A 2gb file for example can kill a server along with other side effects of memory starvation, especially in cloud environments.</p>
<p>The stream buffer provides as destination stream that can be written to and read from at the same time, but limiting the amount of &quot;in flight data&quot; or buffer size.</p>
<p><a href="https://learn.microsoft.com/en-us/dotnet/standard/io/pipelines#backpressure-and-flow-control">How it works: Understanding pipes, flow control and not dead-locking.</a></p>
<h1 id="examples"># Examples</h1>
<ol>
<li>streaming a file as an MVC http response</li>
</ol>
<pre><code class="language-c#">
 // Using memory stream - this is the in memory problem

        var blobClient = container.GetBlobClient(blobPath);
        var resultStream = new MemoryStream();

            await blobClient.DownloadToAsync(resultStream);
            // Reset the stream.
            resultStream.position = 0;

            // Return the stream.
        return new FileStreamResult(stream, &quot;application/pdf&quot;)
 
</code></pre>
<pre><code class="language-c#">
 // Using buffer stream - eliminates memory issue

        var blobClient = container.GetBlobClient(blobPath);
        var resultStream = new StreamBuffer();

            await blobClient.DownloadToAsync(resultStream.WriteStream);

            // Return the stream.
        return new FileStreamResult(resultStream.ReadStream, &quot;application/pdf&quot;)
 
</code></pre>
<p>This example is very basic and does not show other advantages including built in alternative threading models etc.</p>
<ul>
<li>Stream Extensions - New functions to copy between streams and to calculate CRC values for a stream.</li>
</ul>
<h1 id="stream-copy-extensions">Stream Copy extensions</h1>
<h1 id="problem-solved-1">Problem solved</h1>
<p>Existing methods on the streams to copy from one stream to another expect to copy the entire stream and block until the process is complete. For streams like the StreamBuffer implementation that block until there is capacity, the applications can hang.</p>
<p>These functions let you copy a subset of the stream from one stream to another and not the entire stream.</p>
<p>When you are testing copy functionality and working with streams where the may be hidden data issues, CRC functions can detect issues and ensure there are no errors in the process.</p>
<h2 id="examples-1">Examples</h2>
<ol start="2">
<li>copying parts of a a stream.</li>
</ol>
<pre><code class="language-cs">
using(var sourceStream = new FileStream(&quot;sourcefile&quot;, FileMode.Open))
{
// Copy 100 bytes from the source stream to the destination stream.
using(var destinationStream = new FileStream(&quot;destinationfile&quot;, FileMode.Create))
{
sourceStream.CopyBytes(destinationStream, 100);
}

</code></pre>
<p>}</p>


                                        </div>
                                <div class="col-lg-2 p-md-0 m-md-0 bg-body">
                                    <div id="right-sidebar" class="sidebar px-0 px-md-3 pt-3">
        <div class=" mb-3 sidebar-root">
            <div class="sidebar-nav-item sidebar-header">On This Page</div>
            <div class="sidebar-nav-children">
                    <div class="sidebar-nav-item"><a href="#dotnetblocks.system.io">DotNetBlocks.System.IO</a></div>
                    <div class="sidebar-nav-item"><a href="#stream-buffer">Stream Buffer</a></div>
                    <div class="sidebar-nav-item"><a href="#problem-solved">Problem solved</a></div>
                    <div class="sidebar-nav-item"><a href="#examples"># Examples</a></div>
                    <div class="sidebar-nav-item"><a href="#stream-copy-extensions">Stream Copy extensions</a></div>
                    <div class="sidebar-nav-item"><a href="#problem-solved-1">Problem solved</a></div>
                        <div class="sidebar-nav-children">
                                <div class="sidebar-nav-item"><a href="#examples-1">Examples</a></div>
                        </div>
            </div>
        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div id="footer" class="p-3 text-white">
            <div class="container-xl">
                <div class="row">
    <div class="offset-lg-2 col-12 col-lg-8">
        <div class="pt-2 font-size-sm text-muted text-center">
            Generated By <a class="text-muted" href="https://statiq.dev">Statiq</a>
        </div>
    </div>
</div>
            </div>
        </div>

        <!-- Scripts -->
        <script>
            $(document).ready(function() {
                quicklink.listen();

                // Bootstrap tooltips
                $('[data-toggle="tooltip"]').tooltip();

				// Keeps the sidebars in view on wider viewports
				let left = null;
				let leftParent = null;
				let right = null;
				let rightParent = null;
                function stickSidebars()
				{
				    if (left == null) {
                        left = $('#left-sidebar');
                        right = $('#right-sidebar');
                    }
                    if (left.length) {
                        if (window.innerWidth >= 768) {
                            if (leftParent == null) {
                                leftParent = left.parent()[0];
                            }
                            if (leftParent) {
                                let leftRect = leftParent.getBoundingClientRect();
                                stickSidebar(left,  leftRect);
                            }
                        } else {
                            left.css('position', 'relative');
                            if (left.css('bottom') != 0) {
                                left.css('bottom', '0');
                            }
                        }
                    }
                    if (right.length) {
                        if (window.innerWidth >= 768) {
                            if (rightParent == null) {
                                rightParent = right.parent()[0];
                            }
                            if (rightParent) {
                                let rightRect = rightParent.getBoundingClientRect();
                                stickSidebar(right,  rightRect);
                            }
                        } else {
                            right.css('position', 'relative');
                            if (right.css('bottom') != 0) {
                                right.css('bottom', '0');
                            }
                        }
                    }
				}
				function stickSidebar(sidebar, rect) {
                    // Bottom
                    if (rect.bottom > window.innerHeight) {
                        sidebar.css('bottom', rect.bottom - window.innerHeight + "px");
                    } else {
                        sidebar.css('bottom', 0);
                    }
                    // Top
                    if (rect.top < 0) {
                        sidebar.css('position', 'sticky');
                    } else {
                        sidebar.css('position', 'absolute');
                    }
				}
				$(window).on("load", function() {
				    stickSidebars();
				});
                $(window).scroll(function() {
				    stickSidebars();
				});
				$(window).resize(function() {
				    stickSidebars();
				})

                // Mermaid diagrams
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-fluid');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();

                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
            });
        </script>

        

        
    </body>
</html>